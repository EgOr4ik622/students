def main():
    print("Укажите путь к файлу json c данными о students:")
    file_path_students = input()
    print("Укажите путь к файлу json c данными o rooms:")
    file_path_rooms = input()
    print("Выберите формат данных для выгрузки:")
    print("1 - JSON")
    print("2 - XML")
    choice = input("Введите номер выбора (1 или 2): ")
    name_db = input('Введите название БД: ')
    name_tb = input('Введите название таблицы студентов: ')
    name_room_tb = input('Введите название таблицы комнат: ')

    # Инициализация менеджера базы данных
    db_manager = DatabaseManager("postgres", "postgres", "egor4ic", "127.0.0.1")

    # Создание базы данных и таблицы
    db_manager.create_database(name_db)
    db_manager = DatabaseManager(name_db, "postgres", "egor4ic", "127.0.0.1")
    db_manager.create_students_table(name_tb)
    db_manager.create_second_table(name_room_tb)

    # Импорт данных
    importer = DataImporter(db_manager)
    importer.import_from_json_students(file_path_students, name_tb)
    importer.import_from_json_rooms(file_path_rooms, name_room_tb)

    # Анализ данных
    stats = RoomStatistics(db_manager, name_tb, name_room_tb)
   
    age_diff_data = stats.get_top_rooms_by_age_difference()
    avg_age_data = stats.get_top_rooms_by_avg_age()
    mixed_sex_data = stats.get_rooms_with_mixed_sex()
    room_students_data = stats.get_rooms_with_student_count()
    list_sql = (age_diff_data, avg_age_data, mixed_sex_data)
    name_sql = ('age_diff_data', 'avg_age_data', 'mixed_sex_data')
    # Экспортируем данные в выбранном формате
    if choice == '1':  # JSON
        for i, ii in zip(list_sql, name_sql):
            DataExporter.export_to_json(
                [{"room_name": row[0]} for row in i],
                (f"{name_sql}.json")
            )
        DataExporter.export_to_json(
            [{"room_name": row[0], "residents_count": row[1]} for row in room_students_data],
            "room_students.json"
        )
    elif choice == '2':  # XML
        for i, ii in zip(list_sql, name_sql):
            DataExporter.export_to_xml(
                i,
                f"{ii}.xml",
                "RoomsStatistics",
                "Room",
                ["room_name"]
            )
        DataExporter.export_to_xml(
            room_students_data,
            "room_students.xml",
            "RoomsStatistics",
            "Room",
            ["room_name", "residents_count"]
        )
    else:
        print("ОШИБКА: Неверный формат данных")

    print("Все данные успешно экспортированы")



if __name__ == "__main__":
    main()
