import json
import psycopg2
import xml.etree.ElementTree as ET


class DatabaseManager:
    def __init__(self, dbname, user, password, host):
        self.dbname = dbname
        self.user = user
        self.password = password
        self.host = host

    def create_connection(self):
        return psycopg2.connect(
            dbname=self.dbname,
            user=self.user,
            password=self.password,
            host=self.host
        )

    def create_database(self, dbname):
        conn = self.create_connection()
        conn.autocommit = True
        cursor = conn.cursor()
        cursor.execute(f"CREATE DATABASE {dbname}")
        cursor.close()
        conn.close()
        print(f"База данных {dbname} успешно создана")

    def create_table(self, table_name):
        conn = self.create_connection()
        cursor = conn.cursor()
        cursor.execute(
            f"CREATE TABLE {table_name} (birthday DATE, id SERIAL PRIMARY KEY, name VARCHAR(70), room INTEGER, sex VARCHAR(50))"
        )
        conn.commit()
        cursor.close()
        conn.close()
        print(f"Таблица {table_name} успешно создана")

    def execute_query(self, query, params=None, fetch=False):
        conn = self.create_connection()
        cursor = conn.cursor()
        cursor.execute(query, params or ())
        result = None
        if fetch:  # Получаем результаты только если это SELECT запрос
            result = cursor.fetchall()
        conn.commit()
        cursor.close()
        conn.close()
        return result
